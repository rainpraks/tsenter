<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Furnituuri sobivuskalkulaator</title>
</head>

<body>
    <div class="content-container">
        <h1> Furnituuri sobivuskalkulaator</h1>
        <form id="myForm" action="/furnituur" method="POST">
            <section>
                <h2>Sisesta parameetrid:</h2>
            </section>
            <table id="furnituurid">
                <tr>
                    <td>
                        <input type="radio" id="kandevKulg" name="k1" value="Kandev Kulg" checked="checked">
                        <label for="kandevKulg" class="radio-button-label">
                            <span class="image-name">90 kraadi külg </span>
                            <a href="https://www.tsenter.ee" class="image-link" target="_blank">www.tsenter.ee</a>
                        </label>
                    </td>
                    <td>
                        <input type="radio" id="lagiPeal" name="k1" value="Lagi Peal">
                        <label for="lagiPeal" class="radio-button-label">
                            <span class="image-name">90 kraadi lagi </span>
                            <a href="https://www.tsenter.ee" class="image-link" target="_blank">www.tsenter.ee</a>
                        </label>
                    </td>
                    <td>
                        <input type="radio" id="eerung" name="k1" value="Eerung">
                        <label for="eerung" class="radio-button-label">
                            <span class="image-name">Eerung </span>
                            <a href="https://www.tsenter.ee" class="image-link" target="_blank">www.tsenter.ee</a>
                        </label>
                    </td>
                    <td>
                        <input type="radio" id="vaheriiul" name="k1" value="Vaheriiul">
                        <label for="vaheriiul" class="radio-button-label">
                            <span class="image-name">Vaheriiul </span>
                            <a href="https://www.tsenter.ee" class="image-link" target="_blank">www.tsenter.ee</a>
                        </label>
                    </td>
                    <td>
                        <input type="radio" id="vahesein" name="k1" value="Vahesein">
                        <label for="vahesein" class="radio-button-label">
                            <span class="image-name">Vahesein </span>
                            <a href="https://www.tsenter.ee" class="image-link" target="_blank">www.tsenter.ee</a>
                        </label>
                    </td>
                </tr>
            </table>
            <table>
                <tr>
                    <th>Konstruktsiooni valiku kriteeriumid</th>
                </tr>
                <tr>
                    <td>
                        Toote ühendused on avatavad ja korduvalt monteeritavad

                        <div id="messageAvatav" class="error-message" style="display: none; color: red;"></div>
                    </td>
                    <td><input type="radio" name="k2" value="avatav">avatav</td>
                    <td><input type="radio" name="k2" value="mitteavatav" checked="checked"> mitteavatav</td>
                </tr>
                <div id="messageAvatav" style="display: none; color: red;">
                </div>
                <tr>
                    <td>Toote ühendused on liimitud</td>
                    <td><input type="radio" name="k3" value="Liimiga" checked="checked">liimiga </td>
                    <td><input type="radio" name="k3" value="Liimita"> liimita</td>
                </tr>
                <tr>
                    <td>Tootja poolt monteeritud/ FP (Klient monteerib)</td>
                    <td><input type="radio" name="mont/fp" value="Monteeritud" checked="checked">monteeritud</td>
                    <td><input type="radio" name="mont/fp" value="Flatpack"> flatpack</td>
                </tr>
                <tr>
                    <td>Furnituuri nähtavus toote pindadel</td>
                    <td><input type="radio" name="nahtavus1" value="Nahtav" checked="checked">nähtav</td>
                    <td><input type="radio" name="nahtavus1" value="mittenahtav"> mittenähtav</td>
                </tr>
                <div id="messageMittenähtav" style="display: none; color: red;"></div>
                <tr>
                    <td>Furnituuri nähtavus välis- või sisepindadel</td>
                    <td><input type="checkbox" name="nahtavus2" value="Valjast Nahtav" checked="checked">väljast nähtav
                    </td>
                    <td><input type="checkbox" name="nahtavus2" value="Seest Nahtav"> seest nähtav</td>
                </tr>
                <tr>
                    <td>Materjal</td>
                    <td><select>
                            <option value="taispuit">täispuit</option>
                            <option value="vineer">vineer</option>
                            <option value="MDF">MDF</option>
                            <option value="PLP">PLP</option>
                            <option value="kergplaat">kergplaat</option>
                <tr>
                    <td>Paksus</td>
                    <td colspan="5"><input type="number" name="thickness" min="10" max="34" value="paksus"> mm</td>
                </tr>
                <tr>
                    <td sügavus class="highlighted">Koostu</td>
                    <td colspan="6"><input type="number" name="thickness" min="40" max="700" value="sugavus"> mm</td>
                </tr>
                <tr>
                    <th>Tehnoloogia valiku kriteeriumid</th>
                </tr>
                <tr>
                    <td>CNC vertikaalse freesimise ja puurimise võimekusega</td>
                    <td><input type="radio" name="CNC" value="CNCjah" checked="checked">jah</td>
                    <td><input type="radio" name="CNC" value="CNCei">ei</td>
                </tr>
                <tr>
                    <td>Serva puurimise võimekus CNC-l või muul seadmel</td>
                    <td><input type="radio" name="servapuurimisevoimekus" value="ServaPuurJAH" checked="checked">jah
                    </td>
                    <td><input type="radio" name="servapuurimisevoimekus" value="ServaPuurEI">ei </td>
                </tr>
                <tr>
                    <td>Lamello masin või vastav agregaat CNC-le</td>
                    <td><input type="radio" name="Lamello" value="LamelloJAH" checked="checked">jah</td>
                    <td><input type="radio" name="Lamello" value="LamelloEI">ei</td>
                </tr>
                <tr>
                    <td>Domino masin või vastav agregaat CNC-le</td>
                    <td><input type="radio" name="Domino" value="dominoJAH" checked="checked">jah</td>
                    <td><input type="radio" name="Domino" value="dominoEI">ei</td>
                </tr>
                <tr>
                    <td>OVVO masin või vastav agregaat CNC-le</td>
                    <td><input type="radio" name="OVVO" value="ovvoJah" checked="checked">jah</td>
                    <td><input type="radio" name="OVVO" value="ovvoEI">ei</td>
                </tr>

        </form>
        </table>
        <section>
            <h2>Tulemused:</h2>
        </section>
        <table class="table3">
            <thead>
                <tr>
                    <th class="nrCell">#</th>
                    <th>Furnituur</th>
                    <th class="ConCell">Konstruktsiooni sobivus</th>
                    <th>Skoor</th>
                    <th>Tehnoloogia sobivus</th>
                    <th>Skoor</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                function toggleLiimiga(enable) {
                    document.querySelector('input[name="k3"][value="Liimiga"]').disabled = !enable;
                    if (!enable) {
                        document.querySelector('input[name="k3"][value="Liimita"]').checked = true;
                    }
                }

                function toggleNähtavus(enable) {
                    document.querySelector('input[name="nahtavus2"][value="Valjast Nahtav"]').disabled = !enable;
                    document.querySelector('input[name="nahtavus2"][value="Seest Nahtav"]').disabled = !enable;
                    if (!enable) {
                        document.querySelector('input[name="nahtavus2"][value="Valjast Nahtav"]').checked = false;
                        document.querySelector('input[name="nahtavus2"][value="Seest Nahtav"]').checked = false;
                    }
                }

                function showMessage(elementId, show, message) {
                    var messageElement = document.getElementById(elementId);
                    if (show) {
                        messageElement.style.display = 'block';
                        messageElement.textContent = message;
                    } else {
                        messageElement.style.display = 'none';
                    }
                }

                document.querySelectorAll('input[name="k2"]').forEach(function (radio) {
                    radio.addEventListener('change', function (e) {
                        if (e.target.value === 'avatav') {
                            toggleLiimiga(false);
                            showMessage('messageAvatav', true, "Ei saa valida liimiga kui on valitud avatav furnituur");
                        } else {
                            toggleLiimiga(true);
                            showMessage('messageAvatav', false);
                        }
                    });
                });

                document.querySelectorAll('input[name="nahtavus1"]').forEach(function (radio) {
                    radio.addEventListener('change', function (e) {
                        if (e.target.value === 'mittenahtav') {
                            toggleNähtavus(false);
                            showMessage('messageMittenähtav', true, "Ei saa valida väljast nähtav või seest nähtav kui on valitud mittenähtav furnituur.");
                        } else {
                            toggleNähtavus(true);
                            showMessage('messageMittenähtav', false);
                        }
                    });
                });
            });
        </script>
        <script>
            async function loadIntoTable(url, table) {
                const tableBody = table.querySelector("tbody");

                async function updateTable() {
                    const formData = new FormData(document.getElementById('myForm'));
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    tableBody.innerHTML = "";  // Clear existing table data

                    // Iterate through each item in the data and add it to the table
                    data.forEach((item, index) => {
                        const row = tableBody.insertRow();
                        const nrCell = row.insertCell();
                        nrCell.textContent = `${index + 1 + "."}`;
                        const nameCell = row.insertCell();

                        const link = document.createElement('a'); // Create an anchor element
                        link.textContent = item.Name; // Set the text content of the anchor element
                        link.href = item.Link; // Set the href attribute of the anchor element
                        link.target = "_blank"; // Set the target attribute to open in a new tab (optional)

                        // Append the anchor element to the table cell
                        nameCell.appendChild(link);
                        // Create image element for image preview
                        const img = document.createElement('img');
                        img.src = item.Image; // Replace 'ImageURL' with the property holding image URL in your 'item' object
                        img.classList.add('image-preview'); // Add CSS class to the image
                        document.body.appendChild(img); // Append image directly to the body element
                        img.style.display = 'none';
                        img.style.maxHeight = '300px'
                        // Event listeners for showing/hiding image on hover
                        nameCell.addEventListener('mouseenter', () => {
                            img.style.display = 'block';
                        });

                        nameCell.addEventListener('mousemove', (event) => {
                            const mouseX = event.clientX;
                            const mouseY = event.clientY;
                            const imgWidth = img.offsetWidth;
                            const imgHeight = img.offsetHeight;
                            const windowWidth = window.innerWidth;
                            const windowHeight = window.innerHeight;

                            let imgLeft = mouseX; // Horizontal offset
                            let imgTop = mouseY + -imgHeight; // Vertical offset

                            // Adjust image position to stay within viewport boundaries
                            if (imgLeft + imgWidth > windowWidth) {
                                imgLeft = windowWidth - imgWidth;
                            }
                            if (imgTop + imgHeight > windowHeight) {
                                imgTop = windowHeight - imgHeight;
                            }

                            img.style.left = imgLeft + 'px';
                            img.style.top = imgTop + 'px';
                        });

                        nameCell.addEventListener('mouseleave', () => {
                            img.style.display = 'none';
                        });


                        // Append image to the table cell
                        nameCell.appendChild(img);

                        // Add other cells as per your requirement
                        const conStarsCell = row.insertCell();
                        conStarsCell.textContent = item.ConStars;

                        const conRatingCell = row.insertCell();
                        conRatingCell.textContent = item.ConRating;

                        const techStarsCell = row.insertCell();
                        techStarsCell.textContent = item.TechStars;

                        const techRatingCell = row.insertCell();
                        techRatingCell.textContent = item.TechRating;
                    });
                }

                // Attach event listener to radio buttons to update the table on change
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', updateTable);
                });
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('input', updateTable);
                });


                // Initial table population (optional)
                updateTable();
            }

            // Load data into the table when a radio button is clicked
            // Note: Adjust the URL as per your server configuration
            loadIntoTable("/furnituur", document.querySelector(".table3"));

        </script>
    </div>
</body>

</html>